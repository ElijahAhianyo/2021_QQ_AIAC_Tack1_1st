# Job1 Utils

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-job1.utils.eval_spearman.evaluate_emb_spearman-start--->
## [job1.utils.eval_spearman.evaluate_emb_spearman](5-job1_utils.md#job1.utils.eval_spearman.evaluate_emb_spearman)

<!---Documatic-section-evaluate_emb_spearman-start--->
```mermaid
flowchart LR
job1.utils.eval_spearman.evaluate_emb_spearman-->job1.utils.eval_spearman.calc_emb_sim
```

### Object Calls

* [job1.utils.eval_spearman.calc_emb_sim](5-job1_utils.md#job1.utils.eval_spearman.calc_emb_sim)

<!---Documatic-block-job1.utils.eval_spearman.evaluate_emb_spearman-start--->
<details>
	<summary><code>job1.utils.eval_spearman.evaluate_emb_spearman</code> code snippet</summary>

```python
def evaluate_emb_spearman(emb, vid_l, label_path):
    vid_df = pd.DataFrame({'id': vid_l})
    vid_df['id'] = vid_df['id'].astype(str)
    vid_df['index'] = vid_df.index
    label = pd.read_csv(label_path, sep='\t', header=None, dtype={0: str, 1: str})
    label = pd.merge(label, vid_df, left_on=[0], right_on=['id'], how='left')
    label = pd.merge(label, vid_df, left_on=[1], right_on=['id'], how='left')
    label['emb_sim'] = calc_emb_sim(emb, list(label['index_x']), list(label['index_y']))
    spear = scipy.stats.spearmanr(label[2], label['emb_sim']).correlation
    return (label, spear)
```
</details>
<!---Documatic-block-job1.utils.eval_spearman.evaluate_emb_spearman-end--->
<!---Documatic-section-evaluate_emb_spearman-end--->

# #
<!---Documatic-section-job1.utils.eval_spearman.evaluate_emb_spearman-end--->

<!---Documatic-section-job1.utils.utils.set_random_seed-start--->
## [job1.utils.utils.set_random_seed](5-job1_utils.md#job1.utils.utils.set_random_seed)

<!---Documatic-section-set_random_seed-start--->
<!---Documatic-block-job1.utils.utils.set_random_seed-start--->
<details>
	<summary><code>job1.utils.utils.set_random_seed</code> code snippet</summary>

```python
def set_random_seed(random_seed):
    random.seed(random_seed)
    np.random.seed(random_seed)
    os.environ['PYTHONHASHSEED'] = str(random_seed)
    torch.manual_seed(random_seed)
    torch.cuda.manual_seed(random_seed)
    torch.cuda.manual_seed_all(random_seed)
    torch.backends.cudnn.deterministic = True
```
</details>
<!---Documatic-block-job1.utils.utils.set_random_seed-end--->
<!---Documatic-section-set_random_seed-end--->

# #
<!---Documatic-section-job1.utils.utils.set_random_seed-end--->

<!---Documatic-section-job1.utils.eval_spearman.calc_emb_sim-start--->
## [job1.utils.eval_spearman.calc_emb_sim](5-job1_utils.md#job1.utils.eval_spearman.calc_emb_sim)

<!---Documatic-section-calc_emb_sim-start--->
<!---Documatic-block-job1.utils.eval_spearman.calc_emb_sim-start--->
<details>
	<summary><code>job1.utils.eval_spearman.calc_emb_sim</code> code snippet</summary>

```python
def calc_emb_sim(query, query_index, candidate_index, bs=1024):
    n = len(query_index)
    n_batch = n // bs + 1
    query = torch.tensor(query).cuda()
    emb_sim_list = []
    for i in range(n_batch):
        left = bs * i
        right = bs * (i + 1)
        if i == n_batch - 1:
            right = n
        emb_left = query[query_index[left:right]].cuda()
        emb_right = query[candidate_index[left:right]].cuda()
        emb_sim = torch.mul(emb_left, emb_right).sum(axis=1)
        emb_sim_list.append(emb_sim.cpu().numpy())
    return np.concatenate(emb_sim_list)
```
</details>
<!---Documatic-block-job1.utils.eval_spearman.calc_emb_sim-end--->
<!---Documatic-section-calc_emb_sim-end--->

# #
<!---Documatic-section-job1.utils.eval_spearman.calc_emb_sim-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)